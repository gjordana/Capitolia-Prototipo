<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Capitolia · Editar contacto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <style>
      .page-title{display:flex;align-items:center;gap:.6rem;margin:1.25rem 0}
      .page-title i{font-size:30px}
      .field-note{font-size:.875rem;color:#6c757d}
      .table td,.table th{vertical-align:middle}
    </style>
  </head>
  <body>
    <!-- Menú reusable -->
    <cap-menu></cap-menu>

    <main class="container-fluid px-4">
      <div class="page-title">
        <i class="fa-solid fa-address-book"></i>
        <h1 class="h2 m-0">Editar contacto</h1>
      </div>

      <form id="frmContacto" novalidate class="row g-3 mb-4">
        <div class="col-12 col-md-3">
          <label for="ContactoID" class="form-label">ContactoID</label>
          <input type="number" class="form-control" id="ContactoID" name="ContactoID" placeholder="(autonumérico)" readonly>
          <div class="field-note">Solo lectura</div>
        </div>

        <div class="col-12 col-md-5">
          <label for="Nombre" class="form-label">Nombre <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="Nombre" name="Nombre" maxlength="100" required>
          <div class="invalid-feedback">El nombre es obligatorio.</div>
        </div>

        <div class="col-12 col-md-4">
          <label for="ClienteID" class="form-label">Cliente</label>
          <select class="form-select" id="ClienteID" name="ClienteID" required>
            <option value="">Seleccione cliente…</option>
          </select>
          <div class="invalid-feedback">Seleccioná un cliente.</div>
        </div>

        <div class="col-12 col-md-4">
          <label for="Email" class="form-label">Email</label>
          <input type="email" class="form-control" id="Email" name="Email" maxlength="100" placeholder="nombre@empresa.com">
          <div class="invalid-feedback">Ingresá un email válido.</div>
        </div>

        <div class="col-12 col-md-4">
          <label for="Telefono" class="form-label">Teléfono</label>
          <input type="tel" class="form-control" id="Telefono" name="Telefono" maxlength="15" placeholder="+54 9 11 5555-5555">
        </div>

        <div class="col-12 col-md-4">
          <label for="ZonaID" class="form-label">Zona</label>
          <select class="form-select" id="ZonaID" name="ZonaID">
            <option value="">Seleccione zona…</option>
          </select>
        </div>

        <div class="col-12">
          <label for="Direccion" class="form-label">Dirección</label>
          <input type="text" class="form-control" id="Direccion" name="Direccion" maxlength="255" placeholder="Calle, número, piso/depto, ciudad">
        </div>

        <div class="col-12 col-md-6">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="CompraProductos" name="CompraProductos">
            <label class="form-check-label" for="CompraProductos">Compra productos</label>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="CompraServicios" name="CompraServicios">
            <label class="form-check-label" for="CompraServicios">Compra servicios</label>
          </div>
        </div>

        <div class="col-12 d-flex justify-content-end gap-2 mt-2">
          <a href="contactos.html" class="btn btn-outline-secondary">
            <i class="fa-solid fa-arrow-left me-2"></i>Volver
          </a>
          <button type="button" id="btnGuardar" class="btn btn-success">
            <i class="fa-solid fa-floppy-disk me-2"></i>Guardar
          </button>
        </div>
      </form>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="menu.js"></script>

    <script>
      // ===== Datos demo (reemplazar con fetch a tu backend) =====
      const clientes = [
        { id: 1001, nombre: 'Distribuidora Sur' },
        { id: 1002, nombre: 'Techno SA' },
        { id: 1003, nombre: 'AgroCampo' },
      ];
      const zonas = [
        { id: 1, nombre: 'Norte' },
        { id: 2, nombre: 'Sur' },
        { id: 3, nombre: 'Centro' },
        { id: 4, nombre: 'Oeste' },
      ];
      // Contacto demo para precargar si viene ?id=
      const contactosDemo = [
        { id: 1, clienteId: 1001, nombre: 'Ana Pérez', email:'ana@capitolia.com', tel:'+54 9 11 1111-1111', zonaId:2, direccion:'Av. Siempreviva 742', compraProd:true, compraServ:false },
        { id: 2, clienteId: 1002, nombre: 'Luis Gómez', email:'luis@capitolia.com', tel:'+54 9 11 2222-2222', zonaId:3, direccion:'Maipú 1100', compraProd:true, compraServ:true },
      ];

      // ===== Helpers =====
      const $ = (id)=>document.getElementById(id);
      function fillSelect(sel, items, valueKey, textKey){
        sel.innerHTML = '<option value="">Seleccione…</option>' + items.map(it => `<option value="${it[valueKey]}">${it[textKey]}</option>`).join('');
      }

      // Llenar combos
      fillSelect($('ClienteID'), clientes, 'id', 'nombre');
      fillSelect($('ZonaID'), zonas, 'id', 'nombre');

      // Precarga por ?id= (DEMO). Reemplazar por fetch(`/api/contactos/{id}`)
      (function precargar(){
        const qs = new URLSearchParams(location.search);
        const id = parseInt(qs.get('id') || '', 10);
        if(!id) return;
        const c = contactosDemo.find(x => x.id === id);
        if(!c) return;

        $('ContactoID').value = c.id;
        $('Nombre').value = c.nombre;
        $('Email').value = c.email || '';
        $('Telefono').value = c.tel || '';
        $('Direccion').value = c.direccion || '';
        $('ClienteID').value = c.clienteId || '';
        $('ZonaID').value = c.zonaId || '';
        $('CompraProductos').checked = !!c.compraProd;
        $('CompraServicios').checked = !!c.compraServ;
      })();

      // Guardar (DEMO): valida y arma payload
      $('btnGuardar').addEventListener('click', () => {
        const frm = $('frmContacto');
        if (!frm.checkValidity()) { frm.classList.add('was-validated'); return; }

        const payload = {
          ContactoID: $('ContactoID').value || null,
          ClienteID: $('ClienteID').value ? parseInt($('ClienteID').value,10) : null,
          Nombre: $('Nombre').value.trim(),
          Email: $('Email').value.trim() || null,
          Telefono: $('Telefono').value.trim() || null,
          ZonaID: $('ZonaID').value ? parseInt($('ZonaID').value,10) : null,
          Direccion: $('Direccion').value.trim() || null,
          CompraServicios: $('CompraServicios').checked,  // BIT
          CompraProductos: $('CompraProductos').checked   // BIT
        };

        console.log('Guardar contacto (demo):', payload);
        // Aquí iría: fetch('/api/contactos' o '/api/contactos/{id}', { method:'POST/PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })

        const ok = document.createElement('div');
        ok.className = 'alert alert-success mt-3';
        ok.innerHTML = '<i class="fa-solid fa-check me-2"></i>Contacto guardado (demo). Mirá la consola para ver el payload.';
        frm.appendChild(ok);
        setTimeout(()=> ok.remove(), 3000);
      });
    </script>
  </body>
</html>
